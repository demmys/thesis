\chapter{序論}
\label{introduction}

\section{背景}
\label{introduction:background}

2015年12月、Apple社が予てよりCocoaおよびCocoa Touchフレームワークを用いたソフトウェアの開発用プログラミング言語として提供していたSwiftをオープンソース化し、同時にLinuxを中心としたさまざまなプラットフォーム上でのソフトウェア開発に使用するための拡張を開始した
% TODO 出典
。
これによりSwiftは、Objective-Cの担ってきたiOSやMac OS Xなどの特定プラットフォームに向けたソフトウェアだけでなく、C++やJavaなど他の汎用プログラミング言語が担ってきたソフトウェアの開発においてもそれらの代替となり得る可能性を持つこととなっており、今後はこれまで以上に様々な拡張と修正が行われていくと予想される。
それに加え、オープンソースソフトウェアにおいては多くのプログラマが開発に関わるようになる都合から、拡張や修正のためのコードに対するレビューのプロセスがバグを事前に防ぐためにより重要となる
% TODO 出典
。

このような状況の変化によって、Swiftコンパイラにはこれまで強く求められていなかったある特徴が求められるようになっている。
それは、Swiftコンパイラのソースコード自体における高い可読性である。

プログラムに対する拡張や修正の効率が、そのプログラムの可読性に大きな影響を受けることはElshoff~\cite{elshoff}で言及されている。
また、コードレビューのようなプロセスでは、プログラムにおける実行速度などの性能の高さではなくコードの読みやすさによってその効率が左右されることが明らかである。
これらのことから、以前はSwiftコンパイラについてよく知る極小数のメンバーによって開発が行われていたために顕著化していなかった高い可読性に対する要求が、今後は高まっていくであろうと考えられる。

一方、Swift以外の汎用言語のコンパイラにおいてはそのソースコードの可読性を高めることを目的の内の1つとして、コンパイラをそのコンパイル対象の言語自体で開発するSelf-host化を行っている例がよく見られる。

表~\ref{table:bootstrapping-languages}はWeb検索エンジンにおけるクエリヒット数からプログラミング言語の知名度を格付けしたTIOBE Index~\cite{tiobe}の2015年12月版において上げられている言語の内、高級汎用言語であるものだけを上位から20言語抽出し、それらの主要なコンパイラにおいてBootstrap化されているものがあるかをまとめたものである。
なお、BootstrapとはSelf-host化によってコンパイラのソースコードから他言語への依存を排除し、以降の新しいバージョンのコンパイラをそのコンパイラ自身でコンパイルできるようにすることを指す。
単にSelf-host化だけが行われている場合はコンパイラ中のコンパイル対象言語で記述された箇所がごく僅かである場合もあるため、表~\ref{table:bootstrapping-languages}ではBootstrap化しているかどうかについてまとめている。

表~\ref{table:bootstrapping-languages}中の20言語の内だけでもBootstrapを採用しているものが7言語あり、 その中に性能の問題からコンパイラ用の言語として採用されづらいインタプリタ型言語なども含まれていることを考慮すれば、かなりの言語がSelf-host化されていることが分かる。

しかし、SwiftのSelf-host化についてSwiftコンパイラのレポジトリ内に記載されているFAQ~\cite{swift-faq}では、Self-host化した際に言語環境を用意するプロセスが煩雑化すること、現時点ではSwiftにコンパイラ開発用の特徴を追加するよりも汎用言語としての特徴追加を優先したいことから、短期的にはSelf-host化を行う予定はないと述べられている。

\begin{table}[hb]
    \begin{center}
        \caption{知名度の高いプログラミング言語のBootstrap状況}
        \begin{tabular}{|c|c|c|m{4.5cm}|}
            \hline
            順位 & 言語名 & Bootstrapされているか & Bootstrapされている主要コンパイラ \\
            \hline
            1 & Java & × & - \\
            \hline
            2 & C & × & - \\
            \hline
            3 & C++ & ◯ & clang, gcc, Microsoft Visual C++ \\
            \hline
            4 & Python & ◯ & PyPy \\
            \hline
            5 & C\# & ◯ & .NET Compiler Platform \\
            \hline
            6 & PHP & × & - \\
            \hline
            7 & Visual Basic .NET & ◯ & .NET Compiler Platform \\
            \hline
            8 & JavaScript & × & - \\
            \hline
            9 & Perl & × & - \\
            \hline
            10 & Ruby & × & - \\
            \hline
            11 & Assembly Language & (高級言語でないため除外) & \\
            \hline
            12 & Visual Basic & × & - \\
            \hline
            13 & Delphi/Object Pascal & ◯ & Free Pascal \\
            \hline
            14 & Swift & × & - \\
            \hline
            15 & Objective-C & × & - \\
            \hline
            16 & MATLAB & (汎用言語でないため除外) & \\
            \hline
            17 & Pascal & × & - \\
            \hline
            18 & R & (汎用言語でないため除外) & \\
            \hline
            19 & PL/SQL & (汎用言語でないため除外) & \\
            \hline
            20 & COBOL & × & - \\
            \hline
            21 & Ada & ◯ & GNAT \\
            \hline
            22 & Fortran & × & - \\
            \hline
            23 & D & ◯ & DMD \\
            \hline
            24 & Groovy & × & - \\
            \hline
        \end{tabular}
        \label{table:bootstrapping-languages}
    \end{center}
\end{table}


\section{本研究が着目する課題}
\label{introduction:issue}

本研究では、~\ref{introduction:background}節で述べたようにSwiftコンパイラの可読性に対する要求が高まっているという点に着目する。

現在のSwiftコンパイラにおけるコードの可読性は既存コードのコーディングスタイルへの追従やレビューの徹底などによって保たれているが、これはコミュニティベースで修正・追加されたコードがオープンソースとなる以前のコードの量を上回ったり、レビュアーが多様化することによって持続できなくなる。


\section{本研究の目的とアプローチ}
\label{introduction:purpose}

本研究ではSwiftコンパイラの可読性を現在のものよりも向上させることを目的とする。
そのアプローチとして、Swiftで記述したSwiftコンパイラを実装し、そのソースコードの可読性を現行のSwiftコンパイラと比較することで、SwiftコンパイラのSelf-host化が可読性の向上に有効であることを示す。

% TODO 要変更
コンパイラのSelf-host化には大きく分けて3つの可読性を向上させうる特徴がある。
まず1つ目は、コンパイラのコードをコンパイル対象の言語で記述できるという点である。
これにより、ソースコードを読むために必要な知識が減るだけでなく、そのコードは間違いなくそのコンパイラの全開発者にとってより馴染み深いものとなる。
次に2つ目は、対象言語が最初にそのコンパイラを記述した言語よりも必ず後発のものとなるために、より高級な構文や機能を保つ場合が多いという点である。
より高級な構文や機能は開発者の理解を助け、可読性を向上させる可能性が高い。
最後に3つ目は、言語仕様中の一部の機能や構文について実際にその機能や構文を用いて実装することができるという点である。
これもその直感的な記述から、一般的に可読性が高まると期待できる。

さらに、Self-host化ではこれらのメリットをコンパイル対象の言語でそのコンパイラを記述し続ける限り継続的に享受できる。
そのためSelf-host化によって、~\ref{introduction:issue}節で述べた時間経過に伴って可読性が維持できなくなっていくという問題や追加の手順によって開発者のコストを増大させてしまうという懸念なく、単純に可読性を向上させ、コンパイラの拡張や修正のコストを減少させられると期待することができる。

しかし、可読性を向上させうる特徴の内、後者2つについては必ずしも可読性を向上させるとは限らない点に注意する必要がある。
実際、Swiftにおいては現行のコンパイラが既に多くの機能を持つ高級言語であるC++で記述されているために、それらの特徴による可読性の向上が自明ではない。

そのため、本研究では実際にSelf-host化したSwiftコンパイラを実装した上で、SwiftとC++の違いからそれぞれのコンパイラのソースコードにおける可読性を決定する要因について慎重に検討し、各コンパイラのソースコードの行数に基づく定量的な指標を用いてその可読性を比較する。

また、コンパイラのSelf-host化はコンパイラのプログラムを全て書き換えてしまうために、可読性の向上だけでない様々な影響を与えうる。
その点について、本論文ではいくつかの事例と実装したコンパイラにおける性能の評価から考察し、実際にSelf-host化を行うにあたっての注意事項としてまとめる。


\section{本論文の構成}

本論文における以降の構成は次の通りである。

% TODO
~\ref{differential}章では、本研究が着目するプログラミング言語Swiftとそのコンパイラの記述言語C++それぞれの特徴についてまとめ、可読性の差が生まれる原因となりうる差異について考察する。
~\ref{methodology}章では、~\ref{differential}章で述べる言語の差異を根拠にSwiftとC++で記述されたコンパイラの可読性の差を検証するための方法について説明する。
~\ref{implementation}章では、本研究で実装したSelf-host化されたSwiftコンパイラの設計について述べ、~\ref{methodology}章で示した検証を行うために十分な機能を有していることを示す。
~\ref{readability}章では、実際に現行のコンパイラとSelf-host化されたコンパイラについて~\ref{methodology}章で述べる可読性の比較を行い、その結果について考察する。
~\ref{side-effect}章では、Self-host化がもたらしうる可読性の向上以外の影響について他の言語における事例から考察し、特にその影響が自明でない性能の低下があるかどうかを知るための方法について述べる。
~\ref{performance}章では、~\ref{side-effect}章で述べる方法で現行のコンパイラとSelf-host化されたコンパイラの性能の差異を比較し、その結果について考察する。
~\ref{conclusion}章では本研究の結論と今後の展望についてまとめる。

%%% Local Variables:
%%% mode: japanese-latex
%%% TeX-master: "../thesis"
%%% End:
