Self-host化によるSwiftコンパイラのソースコード可読性の向上

1. 序論 :introduction
    1. 背景 :background
        * Swiftがオープンソース化した
        * マルチプラットフォームへの展開
        * プログラムの拡張・修正が増える
        * 多くのプログラマが関わり、レビューの重要性が高まる
        * それらの効率を上げるために可読性は重要
        * 可読性をあげるための手段としてSelf-host化がある
        * 人気の高級汎用言語20件のうち7件がBootstrapしている
          (完全に置き換えるステップ全体を指してBootstrapと呼ぶ)
        * Swiftでは短期的にBootstrapを行うつもりはないとされている
    2. 本研究が着目する課題 :issue
        * 可読性に対する要求が高まっているという点に着目する
        * 現在は既存コードのコーディングスタイルへの追従とレビューで保たれている
        * 追加コードが多くなったりレビュアーが多様化すると維持できなくなる
    3. 本研究の目的とアプローチ :purpose
        * Swiftコンパイラの可読性を向上させることを目的とする
        * アプローチとして、他のコンパイラでよく行われているSelf-host化を用いる
    3. 本論文の構成
2. プロジェクトのオープンソース化が与える影響 :open-source<br>
   Swiftが行ったオープンソース化の一般的な特徴とそれに伴う変化について述べ、本研究で着目する課題を整理する
    1. オープンソースプロジェクトの特徴 :feature
        * オープンソースプロジェクトとは
            * Open Source Initiativeが定義を与えている(http://opensource.org/docs/osd)
                1. そのソフトウェア全体を含むソフトウェアの販売・頒布を使用料を課すなどして制限しない
                2. ソースコードを利用・改変しやすい形で使用料などを課さずに公開し、その再頒布を制限しない
                3. そのソフトウェアの改変・派生および改変・派生したものの同ライセンスでの頒布ができる
                4. ソースコードとパッチファイルを共に頒布でき、変更されたソフトウェアの頒布が明確に認められていれば、改変されたソースコードの頒布を制限してもよい
                5. 特定の個人や団体を差別しない
                6. 利用する分野を制限しない
                7. 再頒布されたものであっても、追加の規約などなしにそのプログラムに付随する権利が認められる
                8. そのプログラムのライセンスの範囲内で使用・頒布される場合は、プログラムの一部分だけであっても同じ権利が認められる
                9. そのソフトウェアと共に頒布されるソフトウェアに対する制限は行わない
                10. 特定の技術やインターフェース形式に限定した条件を課さない
            * オープンソースプロジェクトではその開発形式もオープンとなる
            * 定義の4番目に当てはまるようなものではない、多くのオープンソースプロジェクトで取られている流れ
                1. 任意のユーザからのソフトウェアの拡張や修正提案・要求
                    * オープンなチケット管理ツールやメーリングリストなどでの拡張・変更提案・バグ報告と議論
                2. 特定の開発者による拡張や修正の実装と提案
                    * パッチファイルの投稿
                    * PullRequestの作成
                3. 他の開発者による実装へのレビュー
                    * コーディングスタイルや機能の必要性に関する指摘や議論
                4. 修正・拡張の本体ソフトウェアへの統合
                    * 拡張・修正後のソフトウェアをプロジェクトの最新バージョンとして置き換え
        * プロジェクト形式の差異
            * 人気エッセイ http://www.catb.org/~esr/writings/cathedral-bazaar/ でオープンソースプロジェクトには「伽藍」と「バザール」という2つの形式があると述べられている
            * 伽藍形式の特徴
                * 中央集権的に開発方針などを指揮し、主な開発を担当する特定集団が存在する
                * 拡張や修正は開発方針に従って行われ、各リリースはよくチェックされる
            * バザール形式の特徴
                * 中心的な開発者が指揮者として与える影響は小さく、どの拡張や修正が実施されるかはコミュニティ全体の動向に左右される
                * リリースは変更が加わるごとに更新され、極端に言えばバグを含んだまま行われる
            * Swiftはバザール形式を目指していると見えるため、ここではバザール形式のオープンソースプロジェクトについて述べる
        * バザール形式のオープンソースプロジェクトにおける開発はそうでないプロジェクトにおける開発と異なる特徴を持つ
            1. 様々な人がプログラムを参照する
                * プログラムのあらゆる箇所に対して任意のタイミングで拡張提案・バグ報告が行われる
            2. 不特定多数のプログラマが開発に携わる
                * プログラムのあらゆる箇所に対して任意のタイミングで拡張・修正が行われる
                * 様々なコーディングスタイルの拡張・修正実装が提案される
            3. ソフトウェアを利用したソフトウェアが開発される
                * ソフトウェアの部分的な利用が試みられる
            4. ソフトウェアの技術中立性が高まる
                * 様々なプラットフォームへの移植が試みられる
    2. クローズドプロジェクトのオープンソース化による変化 :change
        * オープンソースプロジェクトには初めからオープンなものと初めはクローズドなものがあるが、ここでは後者について述べる
        * :open-source:featureで述べた特徴とクローズドプロジェクトの特徴を比較して変化をまとめる
        * バザール形式でオープンソース化すると、中央管理的に判断されていた事項が民主的に判断されるようになるという変化が最も大きい
            1. 拡張や修正の要求・実装が行われるかどうかを決定する要因の変化
                * クローズドなプロジェクトではリソースが限られているため、一定の開発方針に従って拡張や修正の優先順位が決定する
                * オープンなプロジェクトではある拡張や修正がそのコストを差し引いても充分な興味を引くものであれば、充分なリソースによって実装されて統合される
            2. コーディングスタイルの流動化
                * クローズドなプロジェクトでは開発者へのコーディングスタイルの徹底が可能なので同じスタイルを維持することができる
                * オープンなプロジェクトでは過去のコードとの統一性も踏まえられるものの、その時々で支持されたコーディングスタイルが用いられるため、スタイルが変動する
            3. 高いモジュール性に対する要求の高まり
                * クローズドなプロジェクトではソフトウェアの利用先などをすべて把握することが可能なのでモジュール化する部分を限定できる
                * オープンなプロジェクトではあらゆる箇所で様々な形でソフトウェアが部分的にも使用されうるため、様々な箇所で高いモジュール性が求められる
            4. マルチプラットフォーム化に対する要求の高まり
                * 各プラットフォームの熱心なユーザにとってそのプラットフォームで対象ソフトウェアを使えるようにすることはそのソフトウェアを使用するための第一歩である
                * クローズドなプロジェクトでは対象とするプラットフォームを制限することが可能
                * オープンなプロジェクトでは各プラットフォームを好む開発者によって移植が進められる
    3. 本研究が着目する課題 :issue
        * クローズドでもオープンでもプロジェクトの目的は変わらず、それはより早くより多くのユーザに使用されるソフトウェアを提供すること
        * :open-source:changeで述べた変化の内、特に1つ目の変化がその目的に直接的な影響を与える
            * リソースは興味とコストの差によって自然と増減するものなので、意図的に変化させられるものではない
            * 統一した開発方針の策定やその修正はバザール形式のオープンソースプロジェクトでは無意味
            * 拡張や修正のコストを下げることが、開発のスピードを向上するための唯一かつ必要最低限の条件となる
        * 拡張や修正のコストはソースコードの可読性によって大きな影響を受ける(Elshoff)
        * つまり、オープンソース化したプロジェクトではプログラムの可読性が開発スピードに大きな影響を与える
        * 本研究では、オープンソース化したばかりのプロジェクトであるSwiftを対象に、可読性の向上が必要になるという課題へ取り組む
3. ソースコード可読性の向上方法と評価手法
    1. ソースコード可読性の向上方法
        * コーディング規約
        * コメント
        * Self-host化
    2. ソースコード可読性の評価手法
        * 行数
        * インデント
    3. 本研究のアプローチ
        * アプローチとして、他のコンパイラでよく行われているSelf-host化を用いる
        * 他の部分は評価が容易でないため、構文解析器のみを対象とする
4. Self-host化による副作用
    1. Self-host化の事例
        1. Go - go
        2. Python - PyPy
        3. C# - .NET Compiler Platform
    2. SwiftコンパイラにおけるSelf-host化の副作用
        * 性能が低下する可能性がある
5. Self-host化したSwiftコンパイラ「TreeSwift」の設計と実装
    1. 構文解析器が満たすべき特徴
        * LL(k)方式で記述されていること
    2. 実装の概要
        1. 構文解析機能
        2. 参照解決機能
        3. 構文解析器のその他の機能
        4. 構文解析以外の実装
6. 評価
    1. ソースコード可読性の向上評価
        1. 評価概要
        2. 計測
        3. 考察
    2. Self-host化に伴う副作用の評価
        1. 評価概要
        2. 計測
        3. 考察
7. 結論
    1. 本研究の結論
    2. 今後の展望
        1. 構文解析器以外の比較
        2. 継続的な比較
